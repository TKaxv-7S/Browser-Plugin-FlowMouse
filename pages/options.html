<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title data-i18n="settings">FlowMouse</title>
	<link rel="stylesheet" href="../css/common.css">
	<link rel="stylesheet" href="../css/option.css">
	<style id="i18n-load-style">
		[data-i18n], [data-i18n-placeholder], [data-i18n-title], select {
			visibility: hidden;
		}
	</style>
</head>

<body class="options-page">
	<div class="container">
		<header>
			<h1>
				<img src="../icons/icon48.png" class="logo-img" alt="Logo">
				<span data-i18n="extName">FlowMouse</span>
				<span class="version version-from-manifest"></span>
			</h1>
		</header>

		<div class="section">
			<h2>🎨 <span data-i18n="appearance">外观设置</span></h2>

			<div class="section-body">
				<div class="setting-row first-row">
					<div class="setting-left">
						<span class="setting-icon icon-theme">
							<svg viewBox="0 0 24 24">
								<path
									d="M20 15.31L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69zM12 18V6c3.31 0 6 2.69 6 6s-2.69 6-6 6z" />
							</svg>
						</span>
						<div class="setting-label">
							<span data-i18n="theme">主题</span>
							<span data-i18n="themeDesc">切换亮色/暗色主题</span>
						</div>
					</div>
					<select id="theme">
						<option value="auto" data-i18n="themeAuto">跟随系统</option>
						<option value="dark" data-i18n="themeDark">深色</option>
						<option value="light" data-i18n="themeLight">浅色</option>
					</select>
				</div>

				<div class="setting-row">
					<div class="setting-left">
						<span class="setting-icon icon-language">
							<svg viewBox="0 0 24 24">
								<path
									d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56zm2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z" />
							</svg>
						</span>
						<div class="setting-label">
							<span data-i18n="language">语言</span>
							<span data-i18n="languageDesc">选择界面语言</span>
						</div>
					</div>
					<select id="language">
						<option value="auto" data-i18n="languageAuto">跟随系统</option>
					</select>
				</div>
			</div>
		</div>

		<div class="section">
			<h2>⚙️ <span data-i18n="basicSettings">基础设置</span></h2>

			<div class="section-body">
				<div class="setting-row first-row">
					<div class="setting-label">
						<span data-i18n="enableGesture">启用手势功能</span>
						<span data-i18n="enableGestureDesc">按住右键并移动鼠标，轻松执行手势操作</span>
					</div>
					<label class="toggle">
						<input type="checkbox" id="enableGesture" checked>
						<span class="slider"></span>
					</label>
				</div>
				<div class="setting-warning" id="macLinuxNotice" style="display: none;">
					<span data-i18n="macLinuxContextMenuNotice">⚠️ 由于系统限制，Mac/Linux 下需快速双击右键才能打开原生菜单</span>
				</div>

				<div class="setting-group" id="gestureSettingsGroup">
					<div class="setting-row">
						<div class="setting-label">
							<span data-i18n="showTrail">显示手势轨迹</span>
							<span data-i18n="showTrailDesc">在执行手势时显示轨迹线</span>
						</div>
						<label class="toggle">
							<input type="checkbox" id="enableTrail" checked>
							<span class="slider"></span>
						</label>
					</div>
					<div class="sub-settings" id="trailSettings">
						<div class="inline-settings">
							<div class="color-setting">
								<span data-i18n="color">颜色</span>
								<input type="color" id="trailColor" value="#4285f4">
							</div>
							<div class="color-setting">
								<span data-i18n="width">粗细</span>
								<input type="number" id="trailWidth" value="5" min="1" max="20">
							</div>
							<div class="color-setting advanced-setting" style="display: none;">
								<label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
									<input type="checkbox" id="showTrailOrigin" checked>
									<span data-i18n="showTrailOrigin">显示起始原点</span>
								</label>
							</div>
							<div class="color-setting advanced-setting" style="display: none;">
								<label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
									<input type="checkbox" id="enableTrailSmooth" checked>
									<span data-i18n="enableTrailSmooth">轨迹平滑</span>
								</label>
							</div>
						</div>
					</div>

					<div class="setting-row">
						<div class="setting-label">
							<span data-i18n="showHint">显示操作提示</span>
							<span data-i18n="showHintDesc">在屏幕中央显示当前手势对应的操作</span>
						</div>
						<label class="toggle">
							<input type="checkbox" id="enableHUD" checked>
							<span class="slider"></span>
						</label>
					</div>
					<div class="sub-settings" id="hudSettings">
						<div class="inline-settings">
							<div class="color-setting">
								<span data-i18n="background">背景</span>
								<input type="color" id="hudBgColor" value="#000000">
							</div>
							<div class="color-setting">
								<span data-i18n="opacity">透明度</span>
								<input type="number" id="hudBgOpacity" value="70" min="0" max="100">%
							</div>
							<div class="color-setting">
								<span data-i18n="text">文字</span>
								<input type="color" id="hudTextColor" value="#ffffff">
							</div>
						</div>
					</div>

					<div class="setting-row advanced-setting" style="display: none;">
						<div class="setting-label">
							<span data-i18n="distanceThreshold">触发距离</span>
							<span data-i18n="distanceThresholdDesc">触发手势方向判断的最小移动距离</span>
						</div>
						<div class="slider-control">
							<input type="range" id="distanceThreshold" min="5" max="100" step="1">
							<span id="distanceThresholdValue">20</span>
						</div>
					</div>
					<div class="setting-notice" id="distanceThresholdNotice" style="display: none;">
						<span data-i18n="distanceThresholdNotice">提示：建议设置为 15-30 之间，手势识别效果最佳。</span>
					</div>

					<div class="setting-row advanced-setting" style="display: none;">
						<div class="setting-label">
							<span data-i18n="scrollAmount">滚动距离</span>
							<span data-i18n="scrollAmountDesc">上下滚动手势的滚动距离（窗口高度百分比）</span>
						</div>
						<div class="slider-control">
							<input type="range" id="scrollAmount" min="25" max="200" value="75" step="5">
							<span id="scrollAmountValue">75%</span>
						</div>
					</div>

					<div class="setting-row advanced-setting" style="display: none;">
						<div class="setting-label">
							<span data-i18n="scrollSmoothness">滚动动画</span>
							<span data-i18n="scrollSmoothnessDesc">上下滚动手势的动画效果</span>
						</div>
						<select id="scrollSmoothness">
							<option value="custom" data-i18n="smoothnessCustom">平滑</option>
							<option value="system" data-i18n="smoothnessSystem">系统 (高性能)</option>
							<option value="none" data-i18n="smoothnessNone">关闭动画</option>
						</select>
					</div>
					<div class="setting-warning advanced-setting" id="scrollSmoothnessWarning" style="display: none;">
						<span data-i18n="reducedMotionWarning">⚠️ 系统动画未启用，可能无法正常显示滚动动画。</span>
					</div>

					<div id="gestureMappingSection">
						<div class="setting-row">
							<div class="setting-label">
								<span data-i18n="enableCustomGestures">自定义手势</span>
								<span data-i18n="enableCustomGesturesDesc">查看并自定义每个手势的操作</span>
							</div>
							<label class="toggle">
								<input type="checkbox" id="enableGestureCustomization">
								<span class="slider"></span>
							</label>
						</div>

						<div id="gestureGridContainer" style="display:none;">
							<div class="setting-notice" data-i18n="gestureAutoSaveHint" style="display:none;">
								提示：修改后自动保存。
							</div>
							<div id="gestureGrid" class="gesture-grid"></div>

							<div class="advanced-setting" style="display: none; margin-bottom: 18px;">
								<button class="btn btn-secondary" id="openGestureDrawer" style="width: 100%;">
									➕ <span data-i18n="addCustomGesture">添加自定义手势</span>
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="section">
			<h2>🔗 <span data-i18n="dragFeatures">拖拽功能</span></h2>

			<div class="section-body">
				<div class="setting-group">
					<div class="setting-row first-row">
						<div class="setting-label">
							<span data-i18n="textDragSearch">文字拖拽搜索</span>
							<span data-i18n="textDragSearchDesc">选中文字后拖拽进行搜索</span>
						</div>
						<label class="toggle">
							<input type="checkbox" id="enableTextDrag" checked>
							<span class="slider"></span>
						</label>
					</div>
					<div class="setting-warning" id="macTextDragNotice" style="display: none;">
						<span data-i18n="macTextDragNotice">⚠️ 受系统特性影响，拖拽文本时需先选中文字，按住左键短暂停顿后再拖动，否则可能无法触发搜索。</span>
					</div>
					<div class="sub-settings" id="textDragSettings">
						<div class="search-engine-row basic-only">
							<span data-i18n="searchEngine">搜索引擎</span>
							<select id="searchEngine">
							</select>
							<input type="text" id="customSearchUrl" data-i18n-placeholder="customUrlPlaceholder"
								placeholder="自定义URL，用 %s 代替搜索词" style="display:none;">
							<label class="inline-checkbox" style="margin-inline-start: 12px; display:none;">
								<input type="checkbox" id="autoDetectUrl">
								<span data-i18n="autoDetectUrl">自动识别链接</span>
							</label>
						</div>
						<div class="advanced-only drag-settings-section">
							<div class="drag-rows-container" id="textDragRows">
							</div>
							<button type="button" class="drag-add-btn" data-type="text">+</button>
						</div>
					</div>
				</div>

				<div class="setting-group">
					<div class="setting-row">
						<div class="setting-label">
							<span data-i18n="imageDrag">图片拖拽打开</span>
							<span data-i18n="imageDragDesc">拖拽图片在新标签页打开</span>
						</div>
						<label class="toggle">
							<input type="checkbox" id="enableImageDrag" checked>
							<span class="slider"></span>
						</label>
					</div>
					<div class="sub-settings advanced-setting" id="imageDragSettings">
						<div class="drag-settings-section">
							<div class="drag-rows-container" id="imageDragRows">
							</div>
							<button type="button" class="drag-add-btn" data-type="image">+</button>
						</div>
					</div>
				</div>

				<div class="setting-group">
					<div class="setting-row">
						<div class="setting-label">
							<span data-i18n="linkDrag">链接拖拽打开</span>
							<span data-i18n="linkDragDesc">拖拽链接在新标签页打开</span>
						</div>
						<label class="toggle">
							<input type="checkbox" id="enableLinkDrag" checked>
							<span class="slider"></span>
						</label>
					</div>
					<div class="sub-settings advanced-setting" id="linkDragSettings">
						<div class="drag-settings-section">
							<div class="drag-rows-container" id="linkDragRows">
							</div>
							<button type="button" class="drag-add-btn" data-type="link">+</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="section">
			<h2>🚫 <span data-i18n="blacklist">网站黑名单</span></h2>
			<div class="section-body">
				<div class="setting-row first-row blacklist-section">
					<div class="blacklist-add">
						<input type="text" id="blacklistInput" data-i18n-placeholder="blacklistPlaceholder"
							placeholder="输入域名，如 example.com，按回车添加">
						<button class="btn btn-primary" id="addDomain" data-i18n="add">添加</button>
					</div>
					<div class="blacklist-list" id="blacklistList">
						<span class="empty-list" data-i18n="emptyBlacklist">暂无黑名单，在上方输入域名添加</span>
					</div>
				</div>
			</div>
		</div>

		<div class="section">
			<h2>🔧 <span data-i18n="enableAdvancedSettings">高级设置</span></h2>
			<div class="section-body">
				<div class="setting-row first-row">
					<div class="setting-label">
						<span data-i18n="enableAdvancedSettingsToggle">高级设置模式</span>
						<span data-i18n="enableAdvancedSettingsDesc">开启后显示更多高级选项</span>
					</div>
					<label class="toggle">
						<input type="checkbox" id="enableAdvancedSettings">
						<span class="slider"></span>
					</label>
				</div>
				<div id="restricted-notice" class="setting-row">
					<div class="setting-label">
						<span data-i18n="showRestrictedNotice">受限页面提醒</span>
						<span data-i18n="showRestrictedNoticeDesc">在无法使用手势的页面显示右键菜单提示</span>
					</div>
					<label class="toggle">
						<input type="checkbox" id="showRestrictedNotice" checked>
						<span class="slider"></span>
					</label>
				</div>
				<details class="collapsible-details" id="restricted-details">
					<summary>
						<span>
							<span data-i18n="restrictedPagesDetailsTitle">⚠️ 由于浏览器的安全策略限制，扩展程序无法在特定类型的页面中运行</span>
							<span class="show-more-hint" data-i18n="showMoreHint">（显示详情）</span>
						</span>
					</summary>
					<div class="details-content">
						<h4 data-i18n="restrictedNewTab">新标签页 (chrome://newtab)</h4>
						<p data-i18n="restrictedNewTabDesc">浏览器默认的新标签页属于受保护的系统页面，扩展程序无法在此页面运行。</p>

						<h4 data-i18n="restrictedStore">官方应用商店页面</h4>
						<p data-i18n="restrictedStoreDesc">例如 Chrome 网上应用店 (https://chromewebstore.google.com)、Edge
							加载项商店 (https://microsoftedge.microsoft.com/) 等。浏览器禁止扩展程序在此类页面运行，以防止恶意扩展干扰商店的正常访问与安装流程。</p>

						<h4 data-i18n="restrictedInternal">浏览器内部管理页面</h4>
						<p data-i18n="restrictedInternalDesc">开头的内部设置、历史记录、下载管理等页面。这些页面涉及浏览器核心功能与用户隐私数据，因此被严格保护。</p>

						<h4 data-i18n="restrictedFile">本地文件页面 (file://)</h4>
						<p data-i18n="restrictedFileDesc">通过 file:// 协议打开的本地 HTML
							文件，由于安全限制（防止恶意扩展访问本地文件系统），扩展程序无法在此类页面运行。</p>
						<h4 data-i18n="restrictedViewSource">查看源代码页面 (view-source:)</h4>
						<p data-i18n="restrictedViewSourceDesc">浏览器提供的源代码查看界面同样属于受保护的系统页面，扩展程序无法在此页面运行。</p>

						<p style="margin-top: 12px; font-style: italic;" data-i18n="restrictedOther">其他不常用受影响的页面不再单独列出。
						</p>
					</div>
				</details>
			</div>
		</div>

		<div class="section">
			<h2>💾 <span data-i18n="dataManagement">数据管理</span></h2>

			<div class="section-body">
				<div class="setting-row first-row">
					<div class="setting-label">
						<span data-i18n="syncStatus">同步状态</span>
						<span data-i18n="syncStatusDesc"></span>
					</div>
					<div class="sync-status" id="syncStatus">
						<span id="syncText" data-i18n="synced">已同步</span>
						<span id="syncTime"></span>
					</div>
				</div>

				<div class="setting-row actions">
					<button class="btn btn-secondary" id="exportSettings" data-i18n="export">导出配置</button>
					<button class="btn btn-secondary" id="importSettings" data-i18n="import">导入配置</button>
					<button class="btn btn-danger" id="resetSettings" data-i18n="reset">恢复默认</button>
				</div>
			</div>

			<div class="section">
				<h2>💬 <span data-i18n="supportAndFeedback">支持与反馈</span></h2>
				<div class="section-body">
					<div class="setting-row first-row">
						<div class="setting-left">
							<span class="setting-icon icon-feedback">
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" data-credit="fontawesome">
									<path
										d="M420.9 448C428.2 425.7 442.8 405.5 459.3 388.1C492 353.7 512 307.2 512 256C512 150 426 64 320 64C214 64 128 150 128 256C128 307.2 148 353.7 180.7 388.1C197.2 405.5 211.9 425.7 219.1 448L420.8 448zM416 496L224 496L224 512C224 556.2 259.8 592 304 592L336 592C380.2 592 416 556.2 416 512L416 496zM312 176C272.2 176 240 208.2 240 248C240 261.3 229.3 272 216 272C202.7 272 192 261.3 192 248C192 181.7 245.7 128 312 128C325.3 128 336 138.7 336 152C336 165.3 325.3 176 312 176z" />
								</svg>
							</span>
							<div class="setting-label">
								<span data-i18n="feedbackTitle"></span>
								<span data-i18n="feedbackText"></span>
							</div>
						</div>
					</div>
					<div class="setting-row">
						<div class="setting-left">
							<span class="setting-icon icon-heart">
								<svg viewBox="0 0 24 24">
									<path
										d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
								</svg>
							</span>
							<div class="setting-label">
								<span data-i18n="supportUsTitle"></span>
								<span data-i18n="supportUsText"></span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="footer">
			<div>
				<span data-i18n="extName">鼠标手势</span> <span class="version-from-manifest">v1.1</span><span
					class="separator">·</span>
				<span data-i18n="author">作者</span>: Hmily[LCG] & Coxxs <span class="separator">·</span>
				<a href="tutorial.html" data-i18n="tutorial">使用教程</a> <span class="separator">·</span>
				<a href="about.html" data-i18n="learnMore">了解更多 →</a>
			</div>

			<div class="privacy-note" data-i18n="privacyNote">
				🔒 纯本地运行，无任何联网，不收集任何用户数据
			</div>
		</div>
	</div>

	<div class="status" id="status" data-i18n="autoSaved">✓ 已自动保存</div>
	<input type="file" id="importFile" accept=".json" style="display:none;">

	<div id="gestureModal" class="modal" style="display: none;" data-gesture-ignore>
		<div class="modal-overlay"></div>
		<div class="modal-content gesture-modal">
			<div class="modal-header">
				<h3 data-i18n="addCustomGesture">添加自定义手势</h3>
				<button class="modal-close" id="closeGestureModal">×</button>
			</div>
			<div class="modal-body">
				<div class="gesture-instructions">
					<span data-i18n="gestureDrawInstructions">按住鼠标右键在下方区域绘制手势，松开后完成绘制。支持方向：</span>
					<span id="gestureDirectionsText">↑ ↓ ← →</span>
				</div>
				<div class="gesture-draw-area">
					<canvas id="gestureCanvas" width="800" height="450"></canvas>
				</div>
				<div class="gesture-info">
					<div class="pattern-display">
						<span data-i18n="gesturePattern">手势序列</span>:
						<span id="drawnPattern" class="pattern-value">-</span>
					</div>
					<div class="action-select">
						<label data-i18n="selectAction">选择动作</label>
						<select id="customGestureAction"></select>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button class="btn btn-secondary" id="clearCanvas" data-i18n="clear" style="display:none">清除</button>
				<button class="btn btn-primary" id="addCustomGesture" data-i18n="addGesture">添加手势</button>
			</div>
		</div>
	</div>

	<script src="../js/i18n.js"></script>
	<script src="../js/constants.js"></script>
	<script src="../js/gesture-visual.js"></script>
	<script src="../js/gesture-recognizer.js"></script>
	<script src="../js/content.js"></script>
	<script src="../js/options.js"></script>
</body>

</html>